# Smart Flow AI - Edge AI Water Monitoring System ğŸ’§ğŸ¤–

![Project Status](https://img.shields.io/badge/Status-Completed-success)
![Platform](https://img.shields.io/badge/Platform-ESP32-blue)
![Language](https://img.shields.io/badge/Language-C%2B%2B%20%7C%20Python-orange)
![License](https://img.shields.io/badge/License-MIT-green)

**Smart Flow AI** is an intelligent IoT device designed to classify residential water usage patterns in real-time. Unlike traditional smart meters that only measure volume, this system uses **Machine Learning on the Edge (TinyML)** to distinguish between activities like **showering, hand washing, toilet flushing, and leaks**.

It operates offline to preserve privacy and uses a GSM module to send SMS alerts immediately upon detecting water leaks.

---

## ğŸš€ Key Features

*   **Real-time Flow Monitoring:** Displays current flow rate (L/min) and total session volume.
*   **Edge AI Classification:** Uses a Decision Tree model running directly on the ESP32 to classify usage into 5 categories:
    *   ğŸš¿ **Shower**
    *   ğŸš° **Tap** (Hand washing/Dishes)
    *   ğŸš½ **Toilet** (Flush)
    *   âš ï¸ **Leak** (Continuous low flow)
    *   ğŸ’¤ **Idle**
*   **Leak Detection & Alerting:** Automatically sends an SMS notification via SIM800C if a leak is detected.
*   **OLED Dashboard:** Visual feedback with progress bars and status indicators.
*   **Privacy First:** All data processing happens locally on the device; no raw data is sent to the cloud.

---

## ğŸ› ï¸ Hardware Requirements

| Component | Quantity | Description |
| :--- | :--- | :--- |
| **ESP32 Dev Module** | 1 | The main processing unit (Dual Core). |
| **YF-S201** | 1 | Hall Effect Water Flow Sensor (1-30 L/min). |
| **SIM800C** | 1 | GSM/GPRS Module for SMS capability. |
| **OLED Display** | 1 | 0.96" I2C OLED (SSD1306 Driver). |
| **LM2596** | 2 | DC-DC Buck Converters (One for Sensor/ESP32, one specifically for SIM800C). |
| **Resistors** | 2 | 1kÎ© and 2kÎ© (For voltage divider on sensor signal). |
| **Power Supply** | 1 | 9V-12V 2A Adapter. |

---

## ğŸ”Œ Wiring Diagram

### Power Distribution
*   **Source (12V)** connects to Inputs of **both** LM2596 modules.
*   **LM2596 #1 (Set to 5V):** Powers the YF-S201 Sensor and ESP32 (via VIN).
*   **LM2596 #2 (Set to 5V):** Powers the SIM800C (Needs high current).

### Pin Connections

| ESP32 Pin | Component Pin | Notes |
| :--- | :--- | :--- |
| **GPIO 15** | Sensor Signal (Yellow) | Connect via Voltage Divider (5V -> 3.3V logic) |
| **GPIO 21 (SDA)** | OLED SDA | |
| **GPIO 22 (SCL)** | OLED SCL | |
| **GPIO 16 (RX2)** | SIM800C TXD | ESP32 Receives from GSM |
| **GPIO 17 (TX2)** | SIM800C RXD | ESP32 Transmits to GSM |
| **GND** | All GNDs | Common Ground is **CRITICAL** |

---

## ğŸ§  The AI Pipeline

This project follows a complete Machine Learning workflow:

1.  **Data Collection:**
    *   Raw pulse data was collected in 5-second windows.
    *   Features extracted: `Mean Flow`, `Max Flow`, `Std Dev`, `Total Pulses`, `Slope`, `Volume`.
2.  **Model Training (Python):**
    *   A **Decision Tree Classifier** was trained using `scikit-learn` on a dataset of simulated and real usage patterns.
    *   The model achieves high accuracy in distinguishing steady flows (Showers) from burst flows (Toilets).
3.  **Rule Extraction:**
    *   The decision tree was exported as a set of nested `if-else` rules.
4.  **Embedded Inference:**
    *   These rules were implemented in C++ within the ESP32 firmware, allowing for zero-latency classification.

---

## ğŸ“‚ Folder Structure

```
Smart-Flow-AI/
â”œâ”€â”€ firmware/
â”‚   â”œâ”€â”€ main.ino            # The final ESP32 firmware (With OLED + GSM + AI)
â”‚   â””â”€â”€ data_gathering.ino  # Script used to collect raw training data
â”œâ”€â”€ model_training/
â”‚   â”œâ”€â”€ generate_data.py    # Python script to generate synthetic datasets
â”‚   â”œâ”€â”€ train_model.py      # Python script to train Decision Tree & export rules
â”‚   â””â”€â”€ flow_model_rules.txt # The C++ logic generated by the script
â”œâ”€â”€ schematics/
â”‚   â””â”€â”€ wiring_diagram.png  # Image of the circuit
â””â”€â”€ README.md
```

---

## ğŸš€ Installation & Usage

### 1. Hardware Setup
Assemble the circuit according to the wiring diagram. Ensure the SIM800C has a dedicated power source (LM2596).

### 2. Software Dependencies
Install the following libraries in Arduino IDE:
*   `Adafruit GFX Library`
*   `Adafruit SSD1306`

### 3. Configuration
Open `firmware/main.ino` and update the phone number for alerts:
```cpp
const String PHONE_NUMBER = "+1234567890"; // Enter your mobile number
```

### 4. Upload
Select **ESP32 Dev Module** as your board and upload the code.

---

## ğŸ§ª Testing

1.  **Idle:** Leave the sensor alone. OLED should show "IDLE".
2.  **Tap:** Blow gently into the sensor (approx 3-5 L/min). OLED shows "Activity: Tap".
3.  **Shower:** Blow hard and consistently (or run high water flow). OLED shows "Activity: Shower".
4.  **Leak:** Blow very, very lightly. OLED will flash **ALERT** and send an SMS.

---

## ğŸ”® Future Improvements

*   Integration with MQTT/Home Assistant for data logging.
*   Adding a Solenoid Valve to automatically shut off water when a leak is detected.
*   PCB design for a compact enclosure.

---

## ğŸ¤ Contributing

Contributions, issues, and feature requests are welcome! Feel free to check the [issues page](issues/).

## ğŸ“„ License

This project is licensed under the MIT License - see the [LICENSE](LICENSE) file for details.
